<!DOCTYPE html>
<html lang="en">

<head>
  <title>Koheron | Scale ML</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Koheron">
  <meta charset="utf-8">

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <script type="text/javascript" src="html-imports.min.js"></script>

  <link rel="shortcut icon" href="kbird.ico">
  <link rel="stylesheet" type="text/css" href="bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="_koheron.css">
  <link rel="stylesheet" type="text/css" href="main.css">

  <script type="text/javascript" src="jquery.min.js"></script>
  <script type="text/javascript" src="bootstrap.min.js"></script>

  <link rel="import" href="navigation.html" data-parent="navigation">
  <link rel="import" href="plot-basics.html" data-parent="plot-basics">
</head>

<body>

  <div id="navigation"></div>

  <div class="container-fluid" id="main">

    <div class="row">
      <div class="col-md-8">
        <section class="panel panel-default plot-panel">
          <div class="panel-heading"><strong>Diagnose Plot</strong></div>
          <div class="panel-body">
            <div id="plot-placeholder" class="plot-placeholder"></div>
            <div id="plot-basics"></div>
          </div>
        </section>

        <section class="panel panel-default" style="padding:12px; margin-bottom:12px;">
          <div class="crossed"><span>Ansicht</span></div>
          <button id="btn-plot-reset-view" class="btn btn-primary btn-block">Standardansicht</button>
        </section>

        <section class="panel panel-default" style="padding:12px; margin-bottom:12px;">
          <div class="crossed"><span>Scale Laufzeit</span></div>
          <div style="font-size: 3.2em; font-weight: 700; margin-bottom: 8px;">
            <span id="weight-value">0.000</span> <span style="font-size: 0.45em;">kg</span>
          </div>
          <div>Live Kapazität: <strong id="ml-live-capacity">-</strong> pF</div>
          <div>Live Gewicht aus C: <strong id="ml-live-weight-from-capacity">-</strong> g</div>
          <button id="btn-tare" class="btn btn-warning btn-block" style="margin-top:8px;">Tara (Null setzen)</button>
          <div style="margin-top: 14px;">
            <div class="form-group">
              <label for="input-calibration">Fallback Faktor (g pro ADC-Schritt)</label>
              <input type="number" id="input-calibration" class="form-control" value="0.5" step="0.0001">
            </div>
            <div class="form-group">
              <label for="input-calibration-offset">Fallback Offset (g)</label>
              <input type="number" id="input-calibration-offset" class="form-control" value="0" step="0.0001">
            </div>
            <button id="btn-save-scale" class="btn btn-success btn-block">Fallback übernehmen</button>
          </div>
        </section>

        <ul class="nav nav-tabs" style="margin-bottom:10px;">
          <li class="active"><a data-toggle="tab" href="#ml-ref-tab">1) Referenz C(m)</a></li>
          <li><a data-toggle="tab" href="#ml-acq-tab">2) Messung Signal->C</a></li>
          <li><a data-toggle="tab" href="#ml-fit-tab">3) Fit & Auswertung</a></li>
        </ul>

        <div class="tab-content">
          <div id="ml-ref-tab" class="tab-pane fade in active">
            <section class="panel panel-default" style="padding:12px; margin-bottom:12px;">
              <div class="crossed"><span>Referenzmodell aus LCR</span></div>
              <div class="row">
                <div class="col-sm-4 form-group">
                  <label for="ml-ref-a">A [pF]</label>
                  <input type="number" id="ml-ref-a" class="form-control" value="2.95" step="0.0001">
                </div>
                <div class="col-sm-4 form-group">
                  <label for="ml-ref-b">b [1/g]</label>
                  <input type="number" id="ml-ref-b" class="form-control" value="0.00162" step="0.000001">
                </div>
                <div class="col-sm-4 form-group">
                  <label for="ml-ref-c0">C0 [pF]</label>
                  <input type="number" id="ml-ref-c0" class="form-control" value="14.59" step="0.0001">
                </div>
              </div>
              <p style="margin:0;">Formel: <code>C(m) = A * exp(b*m) + C0</code> und <code>m(C) = ln((C-C0)/A)/b</code></p>
            </section>
          </div>

          <div id="ml-acq-tab" class="tab-pane fade">
            <section class="panel panel-default" style="padding:12px; margin-bottom:12px;">
              <div class="crossed"><span>Signal->Kapazität Konfiguration</span></div>
              <div class="row">
                <div class="col-sm-4 form-group">
                  <label for="ml-model-select">Modelltyp</label>
                  <select id="ml-model-select" class="form-control">
                    <option value="linear">Linear</option>
                    <option value="quadratic">Quadratisch</option>
                    <option value="exponential">Exponentiell</option>
                  </select>
                </div>
                <div class="col-sm-4 form-group">
                  <label for="ml-signal-feature">Signal-Feature x</label>
                  <select id="ml-signal-feature" class="form-control">
                    <option value="delta">delta_counts</option>
                    <option value="abs_delta">abs(delta_counts)</option>
                    <option value="adc_raw">adc_raw</option>
                    <option value="log_abs_delta">log(abs(delta)+1)</option>
                  </select>
                </div>
                <div class="col-sm-4 form-group">
                  <label for="ml-avg-count">Mittelung ADC</label>
                  <input type="number" id="ml-avg-count" class="form-control" value="16" min="1" step="1">
                </div>
              </div>
              <div class="checkbox" style="margin-top:0;">
                <label><input type="checkbox" id="ml-inverse-mode"> Globaler Inverse-Modus auf x</label>
              </div>
              <div class="row">
                <div class="col-sm-4 form-group">
                  <label for="ml-fit-sample-scope">Trainingsdaten</label>
                  <select id="ml-fit-sample-scope" class="form-control">
                    <option value="all">Alle Messungen</option>
                    <option value="active_model">Nur aktiver Modus</option>
                  </select>
                </div>
                <div class="col-sm-4 form-group">
                  <label for="ml-outlier-sigma">Outlier-Sigma</label>
                  <input type="number" id="ml-outlier-sigma" class="form-control" value="0" min="0" step="0.1">
                </div>
                <div class="col-sm-4 form-group">
                  <label for="ml-ridge-lambda">Ridge λ</label>
                  <input type="number" id="ml-ridge-lambda" class="form-control" value="0" min="0" step="0.0001">
                </div>
              </div>
              <div class="row">
                <div class="col-sm-6 form-group">
                  <label for="ml-factor-ref-delta">Referenzpunkt für lokalen Faktor</label>
                  <input type="number" id="ml-factor-ref-delta" class="form-control" value="0" step="1">
                </div>
                <div class="col-sm-6 form-group">
                  <label for="ml-criterion-select">Kriterium (Info)</label>
                  <select id="ml-criterion-select" class="form-control">
                    <option value="rmse">RMSE</option>
                    <option value="mae">MAE</option>
                    <option value="maxerr">Max Fehler</option>
                    <option value="r2">R²</option>
                  </select>
                </div>
              </div>
            </section>

            <section class="panel panel-default" style="padding:12px; margin-bottom:12px;">
              <div class="crossed"><span>Messung mit Referenzgewicht</span></div>
              <div class="form-group">
                <label for="input-ml-real-weight">Referenzgewicht m_ref [g]</label>
                <input type="number" id="input-ml-real-weight" class="form-control" step="1" min="0" value="100">
              </div>
              <button id="btn-ml-measure-add" class="btn btn-primary btn-block">Messung durchführen & Punkt speichern</button>
              <div style="margin-top:8px;">Letzte m-Vorhersage: <strong id="ml-last-measured-weight">-</strong> g</div>
              <div>ADC Rohwert: <strong id="ml-last-adc">-</strong></div>
            </section>
          </div>

          <div id="ml-fit-tab" class="tab-pane fade">
            <section class="panel panel-default" style="padding:12px; margin-bottom:12px;">
              <div class="crossed"><span>Signal->C Fit Ergebnis</span></div>
              <div>Aktives Modell: <strong id="ml-recommended-model">-</strong></div>
              <div>Verwendete Samples: <strong id="ml-recommended-used-samples">-</strong></div>
              <div>Lokaler Faktor dC/dx: <strong id="ml-recommended-factor">-</strong></div>
              <div>Offset C(x=0): <strong id="ml-recommended-offset">-</strong> pF</div>
              <div>MAE [pF]: <strong id="ml-recommended-mae">-</strong></div>
              <div>RMSE [pF]: <strong id="ml-recommended-rmse">-</strong></div>
              <div>Max-Fehler [pF]: <strong id="ml-recommended-max-error">-</strong></div>
              <div>R²: <strong id="ml-recommended-r2">-</strong></div>
              <button id="btn-ml-apply-recommended" class="btn btn-success btn-block" style="margin-top:10px;">Signal->C Modell übernehmen</button>
            </section>

            <section class="panel panel-default" style="padding:12px; margin-bottom:12px;">
              <div class="crossed"><span>Messdatensatz</span></div>
              <div style="max-height:240px; overflow:auto;">
                <table class="table table-condensed table-striped" style="margin-bottom:0;">
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>m_ref [g]</th>
                      <th>C_ref [pF]</th>
                      <th>C_pred [pF]</th>
                      <th>m_pred [g]</th>
                      <th>ADC</th>
                      <th>delta</th>
                      <th>Feature</th>
                      <th>Modus</th>
                      <th>e_C [pF]</th>
                      <th>e_m [g]</th>
                    </tr>
                  </thead>
                  <tbody id="ml-samples-body"></tbody>
                </table>
              </div>
            </section>

            <section class="panel panel-default" style="padding:12px; margin-bottom:12px;">
              <div class="crossed"><span>Plot & Details</span></div>
              <div class="form-group">
                <label for="ml-sample-select">Messwert auswählen</label>
                <select id="ml-sample-select" class="form-control">
                  <option value="">Keine Messung ausgewählt</option>
                </select>
              </div>
              <div id="ml-plot-placeholder" style="height:240px; border:1px solid #ddd; margin-bottom:10px;"></div>
              <div id="ml-selected-details">Keine Messung ausgewählt.</div>
            </section>

            <section class="panel panel-default" style="padding:12px; margin-bottom:12px;">
              <div class="crossed"><span>Reset</span></div>
              <button id="btn-ml-reset-values" class="btn btn-danger btn-block">Alle ML-Werte löschen</button>
            </section>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <section class="panel panel-default" style="padding:12px; margin-bottom:12px;">
          <div class="crossed"><span>Signalquelle</span></div>
          <div class="form-group">
            <label for="signal-mode">Mode</label>
            <select id="signal-mode" class="form-control">
              <option value="0">BRAM Ramp (Original)</option>
              <option value="1">Sinus</option>
              <option value="2">Saegezahn</option>
              <option value="3">Dreieck</option>
            </select>
          </div>
          <label for="slider1">f (Hz): <strong id="freq-value">10000</strong></label>
          <input type="range" id="slider1" min="8000" max="100000" value="10000">
        </section>

        <section class="panel panel-default" style="padding:12px; margin-bottom:12px;">
          <div class="crossed"><span>Kurven</span></div>
          <div><label><input type="checkbox" id="curve-in1"> IN1</label></div>
          <div><label><input type="checkbox" id="curve-in2"> IN2</label></div>
          <div><label><input type="checkbox" id="curve-out1"> OUT1</label></div>
          <div><label><input type="checkbox" id="curve-out2"> OUT2</label></div>
          <div><label><input type="checkbox" id="curve-weight"> Weight (kg)</label></div>
        </section>

        <section class="panel panel-default" style="padding:12px; margin-bottom:12px;">
          <div class="crossed"><span>RMS</span></div>
          <div>RMS IN1: <strong id="rms-in1">0</strong> V</div>
          <div>RMS IN2: <strong id="rms-in2">0</strong> V</div>
          <div>RMS OUT1: <strong id="rms-out1">0</strong> V</div>
          <div>RMS OUT2: <strong id="rms-out2">0</strong> V</div>
        </section>

        <section class="panel panel-default" style="padding:12px;">
          <div class="crossed"><span>ADC / DAC</span></div>
          <div>IN1 (ADC0): <strong id="adc0-value">0</strong></div>
          <div>IN2 (ADC1): <strong id="adc1-value">0</strong></div>
          <div>OUT1 (DAC0): <strong id="dac0-value">0</strong></div>
          <div>OUT2 (DAC1): <strong id="dac1-value">0</strong></div>
        </section>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
  <script language="javascript" type="text/javascript" src="jquery.flot.js"></script>
  <script language="javascript" type="text/javascript" src="jquery.flot.resize.js"></script>
  <script language="javascript" type="text/javascript" src="jquery.flot.selection.js"></script>
  <script language="javascript" type="text/javascript" src="jquery.flot.time.js"></script>
  <script language="javascript" type="text/javascript" src="jquery.flot.axislabels.js"></script>

</body>

</html>
